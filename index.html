<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Copy Hub - ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡πä‡∏≠‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: "Inter", "Noto Sans Thai", sans-serif; }
  </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen">
  <div class="max-w-6xl mx-auto px-4 py-6">
    <header class="mb-6">
      <h1 class="text-3xl font-bold">üìã Copy Hub</h1>
      <p class="text-slate-600">‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‡∏Å‡πä‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡πÑ‡∏ß ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö/‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <section class="md:col-span-1 bg-white rounded-2xl shadow p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-lg font-semibold">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
          <button id="add-category-btn" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
        <div id="category-list" class="space-y-2"></div>
      </section>

      <section class="md:col-span-2 bg-white rounded-2xl shadow p-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-4">
          <h2 id="category-title" class="text-lg font-semibold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
          <button id="add-item-btn" class="px-3 py-1.5 bg-emerald-600 text-white rounded-lg text-sm hover:bg-emerald-700 disabled:bg-slate-300" disabled>+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
        </div>

        <div id="item-list" class="space-y-3"></div>
      </section>
    </div>
  </div>

  <dialog id="category-dialog" class="rounded-xl p-0 w-full max-w-md backdrop:bg-black/40">
    <form id="category-form" class="p-5 space-y-3">
      <h3 id="category-dialog-title" class="text-lg font-semibold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
      <input id="category-name-input" name="name" required maxlength="60" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <div class="flex justify-end gap-2">
        <button type="button" onclick="document.getElementById('category-dialog').close()" class="px-3 py-2 rounded-lg bg-slate-200">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="px-3 py-2 rounded-lg bg-blue-600 text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>
  </dialog>

  <dialog id="item-dialog" class="rounded-xl p-0 w-full max-w-xl backdrop:bg-black/40">
    <form id="item-form" class="p-5 space-y-3">
      <h3 id="item-dialog-title" class="text-lg font-semibold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3>
      <textarea id="item-text-input" name="text" required rows="5" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πä‡∏≠‡∏õ" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"></textarea>
      <div class="flex justify-end gap-2">
        <button type="button" onclick="document.getElementById('item-dialog').close()" class="px-3 py-2 rounded-lg bg-slate-200">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="submit" class="px-3 py-2 rounded-lg bg-emerald-600 text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>
  </dialog>

  <script>
    const STORAGE_KEY = 'copy_hub_data_v1';

    const defaultData = {
      categories: [
        {
          id: crypto.randomUUID(),
          name: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢',
          items: [
            { id: crypto.randomUUID(), text: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡πÑ‡∏´‡∏ô‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞ üòä' },
            { id: crypto.randomUUID(), text: '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏Ñ‡πà‡∏∞' }
          ]
        }
      ],
      selectedCategoryId: null
    };

    let state = loadData();
    if (!state.selectedCategoryId && state.categories[0]) {
      state.selectedCategoryId = state.categories[0].id;
      saveData();
    }

    let editingCategoryId = null;
    let editingItemId = null;

    function loadData() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return structuredClone(defaultData);
      try {
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed.categories)) return structuredClone(defaultData);
        return parsed;
      } catch {
        return structuredClone(defaultData);
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function getSelectedCategory() {
      return state.categories.find(c => c.id === state.selectedCategoryId) || null;
    }

    function escapeHtml(text) {
      return text
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    async function copyText(text) {
      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          const temp = document.createElement('textarea');
          temp.value = text;
          document.body.appendChild(temp);
          temp.select();
          document.execCommand('copy');
          temp.remove();
        }
        alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
      } catch {
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
      }
    }

    function render() {
      const categoryList = document.getElementById('category-list');
      const itemList = document.getElementById('item-list');
      const categoryTitle = document.getElementById('category-title');
      const addItemBtn = document.getElementById('add-item-btn');

      categoryList.innerHTML = state.categories.map(category => {
        const active = category.id === state.selectedCategoryId;
        return `
          <div class="border rounded-xl p-3 ${active ? 'border-blue-500 bg-blue-50' : 'border-slate-200'}">
            <div class="flex items-center justify-between gap-2">
              <button onclick="selectCategory('${category.id}')" class="text-left flex-1">
                <p class="font-medium">${escapeHtml(category.name)}</p>
                <p class="text-xs text-slate-500">${category.items.length} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
              </button>
              <div class="flex gap-1 shrink-0">
                <button onclick="openCategoryDialog('${category.id}')" class="px-2 py-1 text-xs bg-slate-200 rounded">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                <button onclick="deleteCategory('${category.id}')" class="px-2 py-1 text-xs bg-red-500 text-white rounded">‡∏•‡∏ö</button>
              </div>
            </div>
          </div>
        `;
      }).join('') || '<p class="text-sm text-slate-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</p>';

      const selected = getSelectedCategory();
      if (!selected) {
        categoryTitle.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà';
        addItemBtn.disabled = true;
        itemList.innerHTML = '<p class="text-sm text-slate-500">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>';
        return;
      }

      addItemBtn.disabled = false;
      categoryTitle.textContent = `‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${selected.name}`;

      itemList.innerHTML = selected.items.map((item, index) => `
        <article class="border border-slate-200 rounded-xl p-3">
          <p class="whitespace-pre-wrap mb-3 text-sm leading-relaxed">${escapeHtml(item.text)}</p>
          <div class="flex flex-wrap gap-2">
            <button onclick="copyItem('${item.id}')" class="px-3 py-1.5 bg-blue-600 text-white rounded text-xs">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
            <button onclick="openItemDialog('${item.id}')" class="px-3 py-1.5 bg-slate-200 rounded text-xs">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button onclick="moveItem('${item.id}', -1)" ${index === 0 ? 'disabled' : ''} class="px-3 py-1.5 bg-amber-500 text-white rounded text-xs disabled:bg-slate-300">‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô</button>
            <button onclick="moveItem('${item.id}', 1)" ${index === selected.items.length - 1 ? 'disabled' : ''} class="px-3 py-1.5 bg-amber-600 text-white rounded text-xs disabled:bg-slate-300">‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á</button>
            <button onclick="deleteItem('${item.id}')" class="px-3 py-1.5 bg-red-500 text-white rounded text-xs">‡∏•‡∏ö</button>
          </div>
        </article>
      `).join('') || '<p class="text-sm text-slate-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</p>';
    }

    function selectCategory(id) {
      state.selectedCategoryId = id;
      saveData();
      render();
    }

    function openCategoryDialog(categoryId = null) {
      editingCategoryId = categoryId;
      const dialog = document.getElementById('category-dialog');
      const title = document.getElementById('category-dialog-title');
      const input = document.getElementById('category-name-input');

      if (categoryId) {
        const category = state.categories.find(c => c.id === categoryId);
        if (!category) return;
        title.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà';
        input.value = category.name;
      } else {
        title.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà';
        input.value = '';
      }
      dialog.showModal();
      input.focus();
    }

    function deleteCategory(categoryId) {
      const category = state.categories.find(c => c.id === categoryId);
      if (!category) return;
      if (!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà "${category.name}" ?`)) return;

      state.categories = state.categories.filter(c => c.id !== categoryId);
      if (state.selectedCategoryId === categoryId) {
        state.selectedCategoryId = state.categories[0]?.id || null;
      }
      saveData();
      render();
    }

    document.getElementById('category-form').addEventListener('submit', (event) => {
      event.preventDefault();
      const name = document.getElementById('category-name-input').value.trim();
      if (!name) return;

      if (editingCategoryId) {
        const category = state.categories.find(c => c.id === editingCategoryId);
        if (category) category.name = name;
      } else {
        const newCategory = { id: crypto.randomUUID(), name, items: [] };
        state.categories.push(newCategory);
        state.selectedCategoryId = newCategory.id;
      }

      saveData();
      render();
      document.getElementById('category-dialog').close();
    });

    function openItemDialog(itemId = null) {
      const selected = getSelectedCategory();
      if (!selected) return;

      editingItemId = itemId;
      const dialog = document.getElementById('item-dialog');
      const title = document.getElementById('item-dialog-title');
      const textarea = document.getElementById('item-text-input');

      if (itemId) {
        const item = selected.items.find(i => i.id === itemId);
        if (!item) return;
        title.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°';
        textarea.value = item.text;
      } else {
        title.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°';
        textarea.value = '';
      }

      dialog.showModal();
      textarea.focus();
    }

    document.getElementById('item-form').addEventListener('submit', (event) => {
      event.preventDefault();
      const selected = getSelectedCategory();
      if (!selected) return;

      const text = document.getElementById('item-text-input').value.trim();
      if (!text) return;

      if (editingItemId) {
        const item = selected.items.find(i => i.id === editingItemId);
        if (item) item.text = text;
      } else {
        selected.items.push({ id: crypto.randomUUID(), text });
      }

      saveData();
      render();
      document.getElementById('item-dialog').close();
    });

    function copyItem(itemId) {
      const selected = getSelectedCategory();
      if (!selected) return;
      const item = selected.items.find(i => i.id === itemId);
      if (!item) return;
      copyText(item.text);
    }

    function deleteItem(itemId) {
      const selected = getSelectedCategory();
      if (!selected) return;
      selected.items = selected.items.filter(i => i.id !== itemId);
      saveData();
      render();
    }

    function moveItem(itemId, direction) {
      const selected = getSelectedCategory();
      if (!selected) return;

      const index = selected.items.findIndex(i => i.id === itemId);
      if (index < 0) return;

      const next = index + direction;
      if (next < 0 || next >= selected.items.length) return;

      [selected.items[index], selected.items[next]] = [selected.items[next], selected.items[index]];
      saveData();
      render();
    }

    document.getElementById('add-category-btn').addEventListener('click', () => openCategoryDialog());
    document.getElementById('add-item-btn').addEventListener('click', () => openItemDialog());

    render();
  </script>
</body>
</html>
